<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tax Waterfall Visualizer · 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0b0f14; --panel:#11161e; --muted:#758199; --text:#e6edf7; --accent:#60a5fa;
      --ring:#1f2937; --good:#34d399; --bad:#f87171; --chip:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .card{background:var(--panel);border:1px solid #1e293b;border-radius:16px;padding:16px}
    .metric{background:#0e1622;border:1px solid #1f2a3b;border-radius:14px;padding:10px 12px}
    .label{color:var(--muted);font-size:.75rem;text-transform:uppercase;letter-spacing:.04em}
    .vchip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid #2a3445;border-radius:999px;padding:4px 10px;font-size:.8rem;color:#cbd5e1}
    .toggle .on{background:#0b1220;color:#93c5fd}
    .range{appearance:none;width:100%;height:6px;border-radius:999px;background:#253042;outline:none}
    .range::-webkit-slider-thumb{appearance:none;height:18px;width:18px;border-radius:50%;background:#60a5fa;border:3px solid #0b0f14;box-shadow:0 0 0 4px rgba(96,165,250,.25)}
    .range::-moz-range-thumb{height:18px;width:18px;border-radius:50%;background:#60a5fa;border:3px solid #0b0f14;box-shadow:0 0 0 4px rgba(96,165,250,.25)}
    .field{display:flex;gap:8px;align-items:center}
    .field input[type="text"], .select{background:#0b1220;border:1px solid #1f2937;border-radius:10px;padding:8px 10px;color:#e5e7eb;width:120px;text-align:right}
    .select{width:100%;text-align:left}
    .legend-dot{display:inline-block;width:10px;height:10px;border-radius:2px;margin-right:6px}
    .bar{position:relative;border:1px solid #223047;background:#0b1220;border-radius:12px;overflow:hidden;height:42px}
    .bar-fill{position:absolute;inset:0;height:100%;background:linear-gradient(90deg,#22d3ee, #60a5fa, #a78bfa);opacity:.7;transform-origin:left}
    .bar-inner{position:relative;z-index:2;display:flex;justify-content:space-between;align-items:center;height:100%;padding:0 12px}
    .bar-muted{opacity:.35}
    .btn{background:#0b1220;border:1px solid #253042;color:#cbd5e1;border-radius:10px;padding:6px 10px;font-weight:600}
    .btn-primary{background:#1d4ed8;border-color:#1d4ed8}
    .btn-ghost{background:transparent}
    .pill{background:#0b1220;border:1px solid #253042;border-radius:999px;padding:3px 8px;color:#cbd5e1;font-size:.8rem}
    .delta{font-variant-numeric:tabular-nums}
    .grid-cols-form{grid-template-columns: 1fr auto}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0b1220;border:1px solid #253042;border-radius:6px;padding:2px 6px;color:#9ca3af}
    .sr{position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0)}
  </style>
</head>
<body>
<div class="max-w-7xl mx-auto p-4 md:p-6 space-y-6">

  <header class="flex flex-wrap items-center justify-between gap-3">
    <div class="space-y-1">
      <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Tax Waterfall Visualizer · 2025</h1>
      <p class="text-sm text-slate-400">Brackets as buckets. Twist the knobs, watch the waterfall, don’t cry.</p>
    </div>
    <div class="flex items-center gap-2">
      <span class="vchip"><span class="legend-dot" style="background:linear-gradient(90deg,#22d3ee,#60a5fa,#a78bfa)"></span>Fill level</span>
      <span class="vchip"><span class="legend-dot" style="background:#34d399"></span>Room to next</span>
      <span class="vchip"><span class="legend-dot" style="background:#f87171"></span>Cut to drop</span>
    </div>
  </header>

  <!-- TOP ROW: Jurisdiction + Quick metrics -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="card space-y-3">
      <div>
        <label class="label">Filing status</label>
        <select id="filingStatus" class="select">
          <option value="single">Single</option>
          <option value="marriedFilingJointly">Married filing jointly</option>
          <option value="headOfHousehold">Head of household</option>
        </select>
      </div>
      <div>
        <label class="label">State</label>
        <select id="state" class="select"></select>
      </div>
      <div class="text-xs text-slate-400">Data year: 2025 federal and state. Federal brackets & standard deduction from IRS. State data loaded from <code class="kbd">states_2025.json</code>.</div>
    </div>

    <div class="card grid grid-cols-2 gap-3">
      <div class="metric"><div class="label">Total income</div><div id="mTotalIncome" class="text-xl font-bold">$0</div></div>
      <div class="metric"><div class="label">Taxable ordinary</div><div id="mTaxable" class="text-xl font-bold">$0</div></div>
      <div class="metric"><div class="label">Federal tax</div><div id="mFed" class="text-xl font-bold">$0</div></div>
      <div class="metric"><div class="label">State tax</div><div id="mState" class="text-xl font-bold">$0</div></div>
      <div class="metric"><div class="label">Effective total</div><div id="mEff" class="text-xl font-bold">0.0%</div></div>
      <div class="metric"><div class="label">Current marginal</div><div id="mMarginal" class="text-xl font-bold">—</div></div>
    </div>

    <div class="card space-y-2">
      <div class="flex gap-2">
        <button id="viewFederal" class="btn btn-primary">Federal</button>
        <button id="viewState" class="btn">State</button>
        <div class="ml-auto flex gap-2">
          <button id="lockBtn" class="btn">Lock baseline</button>
          <button id="clearLockBtn" class="btn btn-ghost">Clear</button>
        </div>
      </div>
      <div id="lockInfo" class="hidden text-sm text-slate-300">
        Baseline locked. Showing Δ vs baseline in chips below.
      </div>
      <div id="deltaChips" class="flex flex-wrap gap-2"></div>
    </div>
  </div>

  <!-- GRID: Inputs + Waterfall + Breakdown -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
    <div class="card space-y-5">
      <h2 class="text-lg font-semibold">Income & Deferrals</h2>

      <div class="space-y-2">
        <div class="text-slate-300 font-semibold" id="earner1Label">Earner 1</div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Salary</label>
          <div class="field">
            <input id="e1SalaryText" type="text" value="120,000">
            <input id="e1Salary" class="range" type="range" min="0" max="500000" step="1000" value="120000">
          </div>
        </div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Bonus / RSU</label>
          <div class="field">
            <input id="e1BonusText" type="text" value="15,000">
            <input id="e1Bonus" class="range" type="range" min="0" max="300000" step="500" value="15000">
          </div>
        </div>
      </div>

      <div id="earner2Box" class="hidden space-y-2">
        <div class="text-slate-300 font-semibold">Earner 2</div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Salary</label>
          <div class="field">
            <input id="e2SalaryText" type="text" value="0">
            <input id="e2Salary" class="range" type="range" min="0" max="500000" step="1000" value="0">
          </div>
        </div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Bonus / RSU</label>
          <div class="field">
            <input id="e2BonusText" type="text" value="0">
            <input id="e2Bonus" class="range" type="range" min="0" max="300000" step="500" value="0">
          </div>
        </div>
      </div>

      <div class="grid grid-cols-form gap-2 items-center">
        <label>Other ordinary (STCG, interest)</label>
        <div class="field">
          <input id="otherOrdText" type="text" value="5,000">
          <input id="otherOrd" class="range" type="range" min="0" max="150000" step="500" value="5000">
        </div>
      </div>

      <div class="border-t border-slate-700 pt-3 space-y-2">
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Traditional 401(k)</label>
          <div class="field">
            <input id="trad401kText" type="text" value="23,500">
            <input id="trad401k" class="range" type="range" min="0" max="23500" step="250" value="23500">
          </div>
        </div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Roth 401(k)</label>
          <div class="field">
            <input id="roth401kText" type="text" value="0">
            <input id="roth401k" class="range" type="range" min="0" max="0" step="250" value="0">
          </div>
        </div>
        <div class="text-xs text-slate-400">
          Combined employee deferral limit per earner: <span id="kLimitLabel">$23,500</span>. Catch-up (50+) not modeled here.
        </div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>HSA (pre-tax)</label>
          <div class="field">
            <input id="hsaText" type="text" value="0">
            <input id="hsa" class="range" type="range" min="0" max="8550" step="50" value="0">
          </div>
        </div>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Itemized deductions</label>
          <div class="field">
            <input id="itemizedText" type="text" value="0">
            <input id="itemized" class="range" type="range" min="0" max="200000" step="250" value="0">
          </div>
        </div>
        <div class="field items-center justify-between">
          <div>
            <label class="label">Deduction mode</label>
            <div class="flex gap-2">
              <button id="dedStd" class="btn btn-primary">Standard</button>
              <button id="dedItem" class="btn">Itemized</button>
            </div>
          </div>
          <div class="text-sm text-slate-300">
            Standard: <span id="stdDedLabel">$0</span>
          </div>
        </div>
      </div>

      <div class="border-t border-slate-700 pt-3 space-y-2">
        <h3 class="text-sm font-semibold text-slate-300">Credits (simple)</h3>
        <div class="grid grid-cols-form gap-2 items-center">
          <label>Other nonrefundable credits</label>
          <div class="field">
            <input id="creditsText" type="text" value="0">
            <input id="credits" class="range" type="range" min="0" max="20000" step="100" value="0">
          </div>
        </div>
        <div class="text-xs text-slate-400">
          Modeled as a straight dollar-for-dollar reduction to federal tax. Complex phaseouts (CTC, AOTC, etc.) deliberately not modeled.
        </div>
      </div>
    </div>

    <!-- CENTER: Waterfall -->
    <div class="lg:col-span-2 card space-y-4">
      <div class="flex items-center justify-between">
        <h2 id="wfTitle" class="text-lg font-semibold">Federal Waterfall (Ordinary Income)</h2>
        <div class="text-sm text-slate-400">
          <span class="pill">To next: <span id="toNext">$0</span></span>
          <span class="pill">To drop: <span id="toDrop">$0</span></span>
        </div>
      </div>
      <div id="waterfall" class="space-y-3"></div>

      <div class="border-t border-slate-700 pt-3">
        <h3 class="text-sm font-semibold text-slate-300 mb-2">Layer breakdown</h3>
        <div id="breakdown" class="text-sm text-slate-300 space-y-1"></div>
      </div>
    </div>
  </div>

  <footer class="text-xs text-slate-500 text-center pt-4">
    Illustration only. Uses 2025 tables; excludes self-employment tax and AMT. Verify with your tax pro before doing anything heroic.
  </footer>

</div>

<script>
/* ----------------------- UTIL ----------------------- */
const fmt = (n) => (isNaN(n)?0:n).toLocaleString('en-US',{maximumFractionDigits:0});
const money = (n) => '$' + fmt(Math.round(n));
const parseMoney = (s) => Number(String(s).replace(/[^0-9.-]/g,'')) || 0;
function syncTextAndRange(textEl, rangeEl, onChange){
  const clamp = () => {
    let v = parseMoney(textEl.value);
    v = Math.min(Math.max(v, parseFloat(rangeEl.min)||0), parseFloat(rangeEl.max)||1e12);
    textEl.value = fmt(v);
    rangeEl.value = v;
    onChange();
  };
  rangeEl.addEventListener('input', ()=>{ textEl.value = fmt(rangeEl.value); onChange(); });
  textEl.addEventListener('change', clamp);
  textEl.addEventListener('blur', clamp);
}
function addDeltaChip(el, label, val){
  const c = document.createElement('span');
  c.className = 'pill delta';
  c.textContent = label + ': ' + (val>=0?'+':'') + money(val);
  el.appendChild(c);
}

/* ----------------------- STATE ----------------------- */
let FED=null, STATES=null;
let view='federal';
let dedMode='standard';
let baseline=null; // for lock & compare
const el = (id)=>document.getElementById(id);

/* ----------------------- LOAD DATA ----------------------- */
async function loadAll(){
  const [fed, states] = await Promise.all([
    fetch('federal_2025.json').then(r=>r.json()),
    fetch('states_2025.json').then(r=>r.json())
  ]);
  FED=fed; STATES=states;
  // Populate state dropdown
  const s = el('state');
  Object.keys(STATES).sort((a,b)=>STATES[a].name.localeCompare(STATES[b].name))
    .forEach(code=>{
      const o=document.createElement('option');
      o.value=code; o.textContent=STATES[code].name; s.appendChild(o);
    });
  s.value='CA';
  el('stdDedLabel').textContent = money(FED.standardDeduction.single);
  updateKLimits(); // sets slider maxima for 401k/Roth
  bindInputs();
  recalc();
}

/* ----------------------- INPUT BINDINGS ----------------------- */
function bindInputs(){
  const map = [
    ['e1SalaryText','e1Salary'], ['e1BonusText','e1Bonus'],
    ['e2SalaryText','e2Salary'], ['e2BonusText','e2Bonus'],
    ['otherOrdText','otherOrd'],
    ['trad401kText','trad401k'], ['roth401kText','roth401k'],
    ['hsaText','hsa'],
    ['itemizedText','itemized'],
    ['creditsText','credits'],
  ];
  map.forEach(([t,r])=> syncTextAndRange(el(t), el(r), recalc));

  // Toggles
  el('viewFederal').addEventListener('click', ()=>{view='federal'; el('viewFederal').classList.add('btn-primary'); el('viewState').classList.remove('btn-primary'); recalc();});
  el('viewState').addEventListener('click',  ()=>{view='state';   el('viewState').classList.add('btn-primary');  el('viewFederal').classList.remove('btn-primary'); recalc();});
  el('dedStd').addEventListener('click', ()=>{dedMode='standard'; el('dedStd').classList.add('btn-primary'); el('dedItem').classList.remove('btn-primary'); recalc();});
  el('dedItem').addEventListener('click', ()=>{dedMode='itemized'; el('dedItem').classList.add('btn-primary'); el('dedStd').classList.remove('btn-primary'); recalc();});

  el('filingStatus').addEventListener('change', ()=>{
    updateKLimits();
    const fs=el('filingStatus').value;
    if(fs==='marriedFilingJointly'){
      el('earner2Box').classList.remove('hidden');
      el('earner1Label').textContent='Earner 1';
      // switch HSA default to family max
      el('hsa').max = 8550; el('hsaText').value = fmt(Math.min(parseMoney(el('hsaText').value), 8550));
    }else{
      el('earner2Box').classList.add('hidden');
      el('earner1Label').textContent='Primary Earner';
      el('e2Salary').value = 0; el('e2SalaryText').value='0';
      el('e2Bonus').value = 0; el('e2BonusText').value='0';
      el('hsa').max = 4300; el('hsaText').value = fmt(Math.min(parseMoney(el('hsaText').value), 4300));
    }
    // Update standard deduction label
    el('stdDedLabel').textContent = money(FED.standardDeduction[fs]);
    recalc();
  });
  el('state').addEventListener('change', recalc);

  // Lock / compare
  el('lockBtn').addEventListener('click', ()=>{
    baseline = compute();
    el('lockInfo').classList.remove('hidden');
    recalc();
  });
  el('clearLockBtn').addEventListener('click', ()=>{
    baseline=null; el('lockInfo').classList.add('hidden'); el('deltaChips').innerHTML=''; recalc();
  });
}

function updateKLimits(){
  const fs = el('filingStatus').value;
  // Employee deferral limit is PER EARNER
  const earners = fs==='marriedFilingJointly' ? 2 : 1;
  const perEarner = FED.contributionLimits.k401.employeeDeferral;
  const totalMax = perEarner * earners;
  // We give Trad+Roth combined cap = totalMax. Individual sliders will be constrained programmatically.
  el('kLimitLabel').textContent = money(perEarner) + ' per earner';
  // Each slider can go to totalMax, but we clamp their sum below.
  el('trad401k').max = totalMax; el('roth401k').max = totalMax;
}

/* ----------------------- CORE MATH ----------------------- */
function clamp401k(){
  const t = parseMoney(el('trad401kText').value);
  const r = parseMoney(el('roth401kText').value);
  const fs = el('filingStatus').value;
  const earners = fs==='marriedFilingJointly' ? 2 : 1;
  const cap = FED.contributionLimits.k401.employeeDeferral * earners;
  let T=t, R=r;
  if(t+r>cap){
    // Keep whichever was just edited? We can’t know. Default: keep Trad, reduce Roth.
    R = Math.max(0, cap - T);
  }
  el('trad401k').value=T; el('trad401kText').value=fmt(T);
  el('roth401k').value=R; el('roth401kText').value=fmt(R);
}
function taxFromBrackets(taxable, brackets){
  if(!brackets || !brackets.length || taxable<=0) return {tax:0, layers:[]};
  let tax=0, last=0, remain=taxable, layers=[];
  for(const b of brackets){
    const size = (isFinite(b.threshold)?b.threshold:Infinity) - last;
    const inBand = Math.max(0, Math.min(remain, size));
    const t = inBand * b.rate;
    tax += t;
    layers.push({rate:b.rate, from:last, to:b.threshold, income:inBand, tax:t});
    remain -= inBand;
    last = b.threshold;
    if(remain<=0) break;
  }
  return {tax, layers};
}

/* compute() returns the model state used for UI */
function compute(){
  clamp401k();

  const fs = el('filingStatus').value;
  const state = el('state').value;

  const e1 = parseMoney(el('e1SalaryText').value) + parseMoney(el('e1BonusText').value);
  const e2 = (fs==='marriedFilingJointly') ? (parseMoney(el('e2SalaryText').value) + parseMoney(el('e2BonusText').value)) : 0;
  const other = parseMoney(el('otherOrdText').value);
  const totalIncome = e1 + e2 + other;

  const trad = parseMoney(el('trad401kText').value);
  const roth = parseMoney(el('roth401kText').value);
  const hsa = parseMoney(el('hsaText').value);
  const aboveLine = trad + hsa; // Roth is not deductible
  const agi = Math.max(0, totalIncome - aboveLine);

  const std = FED.standardDeduction[fs];
  const item = parseMoney(el('itemizedText').value);
  const deduction = (dedMode==='standard') ? std : item;

  const taxableOrd = Math.max(0, agi - deduction);

  // Federal tax (credits applied after bracket tax)
  const fed = taxFromBrackets(taxableOrd, FED.brackets[fs]);
  const credits = parseMoney(el('creditsText').value);
  const fedAfterCredits = Math.max(0, fed.tax - credits);

  // State tax (simple model: ordinary base)
  const stBr = STATES[state]?.brackets?.[fs] || [];
  const stateTax = taxFromBrackets(taxableOrd, stBr).tax;

  const totalTax = fedAfterCredits + stateTax;
  const eff = totalIncome>0 ? (totalTax/totalIncome*100) : 0;

  // marginal rate & proximity to next/prev
  const layers = (view==='federal') ? fed.layers : taxFromBrackets(taxableOrd, stBr).layers;
  let currentLayer = layers.find(l => l.income>0 && (l.to===Infinity || taxableOrd <= l.to));
  if(!currentLayer && layers.length) currentLayer = layers[layers.length-1];
  let toNext=0, toDrop=0, marginal='—';
  if(currentLayer){
    const size = (isFinite(currentLayer.to)?currentLayer.to:Infinity) - currentLayer.from;
    const used = currentLayer.income;
    const room = (isFinite(size)?size:Infinity) - used;
    toNext = isFinite(room)? room : 0;
    toDrop = used>0 ? used+1 : 0;
    marginal = Math.round(currentLayer.rate*100) + '%';
  }
  return {
    fs, state,
    totalIncome, agi, taxableOrd, deduction, std,
    fedTax: fedAfterCredits, stateTax, totalTax, eff, marginal,
    toNext, toDrop,
    layers, baseLayers: fed.layers
  };
}

/* ----------------------- RENDER ----------------------- */
function recalc(){
  const s = compute();

  // metrics
  el('mTotalIncome').textContent = money(s.totalIncome);
  el('mTaxable').textContent = money(s.taxableOrd);
  el('mFed').textContent = money(s.fedTax);
  el('mState').textContent = money(s.stateTax);
  el('mEff').textContent = (s.eff||0).toFixed(1)+'%';
  el('mMarginal').textContent = s.marginal;

  // title, to-next / to-drop
  el('wfTitle').textContent = (view==='federal'?'Federal':'State') + ' Waterfall (Ordinary Income)';
  el('toNext').textContent = money(s.toNext);
  el('toDrop').textContent = money(s.toDrop);

  // deltas if locked
  const chips = el('deltaChips');
  chips.innerHTML = '';
  if(baseline){
    addDeltaChip(chips,'Δ Income', s.totalIncome - baseline.totalIncome);
    addDeltaChip(chips,'Δ Taxable', s.taxableOrd - baseline.taxableOrd);
    addDeltaChip(chips,'Δ Total tax', s.totalTax - baseline.totalTax);
    const effDelta = (s.eff - baseline.eff);
    const c = document.createElement('span'); c.className='pill delta';
    c.textContent = 'Δ Effective: ' + (effDelta>=0?'+':'') + effDelta.toFixed(1) + ' pts';
    chips.appendChild(c);
  }

  // breakdown and waterfall
  renderWaterfall(s);
}

function renderWaterfall(s){
  const container = el('waterfall'); container.innerHTML='';
  const breakdown = el('breakdown'); breakdown.innerHTML='';

  const layers = s.layers;
  if(!layers.length){
    const p=document.createElement('div');
    p.className='text-slate-400'; p.textContent='No taxable ordinary income.';
    container.appendChild(p); return;
  }

  let seenMarginal=false;
  layers.forEach((L, idx)=>{
    const isMarginal = !seenMarginal && (L.income>0) && (L.to===Infinity || s.taxableOrd<=L.to);
    if(isMarginal) seenMarginal=true;

    const size = (isFinite(L.to)?L.to:Infinity) - L.from;
    const fillPct = isFinite(size)? (L.income/size*100) : 100;

    const row=document.createElement('div'); row.className='bar' + (isMarginal?'':' bar-muted');
    const fill=document.createElement('div'); fill.className='bar-fill'; fill.style.width = Math.min(100, Math.max(0, fillPct)) + '%';
    const inner=document.createElement('div'); inner.className='bar-inner';

    const left=document.createElement('div');
    left.innerHTML = `<div class="font-semibold">${Math.round(L.rate*100)}% rate</div>
                      <div class="text-xs text-slate-400">${isFinite(L.to)? (money(L.from+1)+' – '+money(L.to)) : ('Over '+money(L.from))}</div>`;
    const right=document.createElement('div');
    right.innerHTML = `<div class="font-semibold">${money(L.income)}</div>
                       <div class="text-xs text-slate-400">Tax: ${money(L.tax)}</div>`;

    inner.appendChild(left); inner.appendChild(right);
    row.appendChild(fill); row.appendChild(inner);
    container.appendChild(row);

    // Insights under the marginal row
    if(isMarginal){
      const room = isFinite(size)? (size - L.income) : 0;
      const tips=document.createElement('div');
      tips.className='text-xs mt-2 ml-1';
      const savePer1k = 1000*L.rate;
      tips.innerHTML = `
        <div class="flex flex-wrap gap-2">
          <span class="pill" style="border-color:#1f5f3a;color:#86efac">Room to next: ${money(room)}</span>
          <span class="pill" style="border-color:#5f1f26;color:#fecaca">Cut to drop: ${money(L.income+1)}</span>
          <span class="pill">Each $1,000 pre-tax saves ${money(savePer1k)} here</span>
        </div>`;
      container.appendChild(tips);
    }

    // breakdown list
    const li=document.createElement('div');
    li.innerHTML = `<span class="text-slate-400">${money(L.from+1)} → ${isFinite(L.to)?money(L.to):'∞'}</span>
                    · <span class="font-semibold">${Math.round(L.rate*100)}%</span>
                    · Income ${money(L.income)} · Tax ${money(L.tax)}`;
    breakdown.appendChild(li);
  });
}

/* ----------------------- KICK ----------------------- */
loadAll();
</script>
</body>
</html>
